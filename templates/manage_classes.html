{% extends 'base.html' %}
{% block content %}
<div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4">Manage Classes</h1>

    <!-- Add Class Form -->
    <div class="mb-8">
        <h2 class="text-xl font-semibold mb-2">Add New Class</h2>
        <form method="POST" class="space-y-4">
            <input type="hidden" name="action" value="add">
            <div>
                <label class="block">Group Name</label>
                <input type="text" name="group_name" class="w-full border p-2" required>
            </div>
            <div>
                <label class="block">Class Name</label>
                <input type="text" name="class_name" class="w-full border p-2" required>
            </div>
            <div>
                <label class="block">Date</label>
                <input type="date" name="date" class="w-full border p-2" required>
            </div>
            <div>
                <label class="block">Group Hours</label>
                <input type="text" name="group_hours" class="w-full border p-2" required>
            </div>
            <div>
                <label class="block">Counselor</label>
                <select name="counselor_id" class="w-full border p-2" required>
                    {% for counselor in counselors %}
                    <option value="{{ counselor[0] }}">{{ counselor[2] }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block">Group Type</label>
                <input type="text" name="group_type" class="w-full border p-2">
            </div>
            <div>
                <label class="block">Notes</label>
                <textarea name="notes" class="w-full border p-2"></textarea>
            </div>
            <div>
                <label class="block">Location</label>
                <input type="text" name="location" class="w-full border p-2" required>
            </div>
            <div>
                <label class="inline-flex items-center">
                    <input type="checkbox" name="recurring" class="mr-2"> Recurring
                </label>
            </div>
            <div>
                <label class="block">Frequency</label>
                <select name="frequency" class="w-full border p-2">
                    <option value="">None</option>
                    <option value="weekly">Weekly</option>
                </select>
            </div>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Add Class</button>
        </form>
    </div>

    <!-- Classes List -->
    <h2 class="text-xl font-semibold mb-2">Existing Classes</h2>
    <table class="w-full border">
        <thead>
            <tr class="bg-gray-200">
                <th class="border p-2">Group Name</th>
                <th class="border p-2">Class Name</th>
                <th class="border p-2">Date</th>
                <th class="border p-2">Hours</th>
                <th class="border p-2">Counselor</th>
                <th class="border p-2">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for class in classes %}
            <tr>
                <td class="border p-2">{{ class[1] }}</td>
                <td class="border p-2">{{ class[2] }}</td>
                <td class="border p-2">{{ class[3] }}</td>
                <td class="border p-2">{{ class[4] }}</td>
                <td class="border p-2">{{ class[11] }}</td>
                <td class="border p-2">
                    <button onclick="openEditModal({{ class[0] }})" class="bg-blue-600 text-white px-2 py-1 rounded">Edit</button>
                    <form method="POST" class="inline">
                        <input type="hidden" name="action" value="delete">
                        <input type="hidden" name="class_id" value="{{ class[0] }}">
                        <button type="submit" class="bg-red-600 text-white px-2 py-1 rounded">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Edit Class Modal -->
    <div id="editClassModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg max-w-lg w-full max-h-screen overflow-y-auto">
            <h2 class="text-xl font-semibold mb-4">Edit Class</h2>
            <form method="POST" id="editClassForm" class="space-y-4">
                <input type="hidden" name="action" value="edit">
                <input type="hidden" name="class_id" id="edit_class_id">
                <div>
                    <label class="block">Group Name</label>
                    <input type="text" name="group_name" id="edit_group_name" class="w-full border p-2" required>
                </div>
                <div>
                    <label class="block">Class Name</label>
                    <input type="text" name="class_name" id="edit_class_name" class="w-full border p-2" required>
                </div>
                <div>
                    <label class="block">Date</label>
                    <input type="date" name="date" id="edit_date" class="w-full border p-2" required>
                </div>
                <div>
                    <label class="block">Group Hours</label>
                    <input type="text" name="group_hours" id="edit_group_hours" class="w-full border p-2" required>
                </div>
                <div>
                    <label class="block">Counselor</label>
                    <select name="counselor_id" id="edit_counselor_id" class="w-full border p-2" required>
                        {% for counselor in counselors %}
                        <option value="{{ counselor[0] }}">{{ counselor[2] }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block">Group Type</label>
                    <input type="text" name="group_type" id="edit_group_type" class="w-full border p-2">
                </div>
                <div>
                    <label class="block">Notes</label>
                    <textarea name="notes" id="edit_notes" class="w-full border p-2"></textarea>
                </div>
                <div>
                    <label class="block">Location</label>
                    <input type="text" name="location" id="edit_location" class="w-full border p-2" required>
                </div>
                <div>
                    <label class="inline-flex items-center">
                        <input type="checkbox" name="recurring" id="edit_recurring" class="mr-2"> Recurring
                    </label>
                </div>
                <div>
                    <label class="block">Frequency</label>
                    <select name="frequency" id="edit_frequency" class="w-full border p-2">
                        <option value="">None</option>
                        <option value="weekly">Weekly</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" onclick="closeEditModal()" class="bg-gray-600 text-white px-4 py-2 rounded">Cancel</button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function openEditModal(classId) {
            fetch(`/get_class/${classId}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('edit_class_id').value = data.id;
                    document.getElementById('edit_group_name').value = data.group_name;
                    document.getElementById('edit_class_name').value = data.class_name;
                    document.getElementById('edit_date').value = data.date;
                    document.getElementById('edit_group_hours').value = data.group_hours;
                    document.getElementById('edit_counselor_id').value = data.counselor_id;
                    document.getElementById('edit_group_type').value = data.group_type || '';
                    document.getElementById('edit_notes').value = data.notes || '';
                    document.getElementById('edit_location').value = data.location;
                    document.getElementById('edit_recurring').checked = data.recurring == 1;
                    document.getElementById('edit_frequency').value = data.frequency || '';
                    document.getElementById('editClassModal').classList.remove('hidden');
                });
        }

        function closeEditModal() {
            document.getElementById('editClassModal').classList.add('hidden');
        }
    </script>
</div>
{% endblock %}
